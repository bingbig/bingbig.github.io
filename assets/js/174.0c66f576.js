(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{326:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),a("p",[s._v("一个函数的执行结果要返回给调用者，除了使用return功能，还有一种办法，那就是以引用的形式传递参数，然后在内部修改这个参数的值。前一种方法往往只能返回一个值，如果我们的函数执行结果具有多种数据，便需要把这些数据打包到一个数组、类等复合类型的变量中才能得以实现；但后一种方法相比而言就简单一些了。")]),s._v(" "),s._m(1),s._v(" "),a("p",[s._v("标题有点绕口，其实很简单，功能如以下php代码所示：")]),s._v(" "),s._m(2),a("p",[s._v("我们在传递参数的时候使用&操作符，便可以传递$foo变量的引用过去，而不是copy一份。当我们在函数内核修改这个参数时，函数外部的$foo也跟着被一起修改了。同样的功能我们如何在扩展里实现呢，其实很简单，请看下面的源码：")]),s._v(" "),s._m(3),s._m(4),s._v(" "),a("p",[s._v("如果每一次都在调用函数时候都对参数加一个&符号真是太罗嗦了，有没有一个简单的办法呢，比如在定义函数的时候便声明这个参数是引用形式的，而不用用户自己加&符号表示引用，而由内核来完成这步操作？这个功能是有的，我们在PHP语言中可以这样实现。")]),s._v(" "),s._m(5),a("p",[s._v("上面的代码中，我们只是把引用符号从函数调用里转移到函数定义里。此功能在扩展里面实现的话就颇费周折了，我们需要提前为它定义一个arginfo结构体来向内核通知此函数的这个特定行为。添加此函数到module_entry里需要这样：")]),s._v(" "),s._m(6),s._m(7),s._v(" "),a("p",[s._v("原书中此处有arginfo在PHP4里的实现，被我略去了。")]),s._v(" "),a("p",[s._v("在Zend Engine 2 (PHP5+)中，arginfo的数据是由多个zend_arg_info结构体构成的数组，数组的每一个成员即每一个zend_arg_info结构体处理函数的一个参数。zend_arg_info结构体的定义如下：")]),s._v(" "),s._m(8),a("p",[s._v("生成zend_arg_info结构的数组比较繁琐，为了方便PHP扩展开发者，内核已经准备好了相应的宏来专门处理此问题，首先先用一个宏函数来生成头部，然后用第二个宏生成具体的数据，最后用一个宏生成尾部代码。")]),s._v(" "),s._m(9),s._m(10),s._v(" "),s._m(11),a("p",[s._v("为了使我们的扩展能够兼容PHP4，还需要使用#ifdef进行特殊处理。")]),s._v(" "),s._m(12),a("p",[s._v("我们copy一份ZEND_FUNCTION(byref_calltime)的实现，并重名成ZEND_FUNCTION(byref_compiletime)就行了。或者直接弄个ZEND_FALIAS就行了：")]),s._v(" "),s._m(13),s._m(14),s._v(" "),a("ul",[a("li",[s._v("6.1 "),a("router-link",{attrs:{to:"./6.1.html"}},[s._v("一个特殊的参数：return_value")])],1),s._v(" "),a("li",[s._v("6.3 "),a("router-link",{attrs:{to:"./6.3.html"}},[s._v("第六章小结")])],1)])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"_6-2-引用与函数的执行结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-引用与函数的执行结果","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.2 引用与函数的执行结果")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"运行时传递引用：call-time-pass-by-ref"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行时传递引用：call-time-pass-by-ref","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行时传递引用：Call-time Pass-by-ref")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token php language-php"}},[a("span",{attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("byref_calltime")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$a")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token variable"}},[s._v("$a")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'(modified by ref!)'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token variable"}},[s._v("$foo")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'I am a string'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("//使用&传递引用")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("byref_calltime")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),a("span",{attrs:{class:"token variable"}},[s._v("$foo")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$foo")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("//输出'(modified by ref!)'")]),s._v("\n\n")])])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("ZEND_FUNCTION")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("byref_calltime"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tzval "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("a"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t"),a("span",{attrs:{class:"token comment"}},[s._v("//将我们接收的参数传给zval *a;")]),s._v("\n\t"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("zend_parse_parameters")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("ZEND_NUM_ARGS")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" TSRMLS_CC"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"z"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("a"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" FAILURE"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{attrs:{class:"token function"}},[s._v("RETURN_NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\n\t"),a("span",{attrs:{class:"token comment"}},[s._v("//如果a不是以引用的方式传递的。")]),s._v("\n\t"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("a"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("is_ref__gc"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \t"),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\n\t"),a("span",{attrs:{class:"token comment"}},[s._v("//将a转成字符串")]),s._v("\n\t"),a("span",{attrs:{class:"token function"}},[s._v("convert_to_string")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\n\t"),a("span",{attrs:{class:"token comment"}},[s._v("//更改数据")]),s._v("\n\t"),a("span",{attrs:{class:"token function"}},[s._v("ZVAL_STRING")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{attrs:{class:"token string"}},[s._v('" (modified by ref!)"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"编译时的传递引用compile-time-pass-by-ref"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译时的传递引用compile-time-pass-by-ref","aria-hidden":"true"}},[this._v("#")]),this._v(" 编译时的传递引用Compile-time Pass-by-ref")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token php language-php"}},[a("span",{attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n在定义函数参数的时候加了引用符\n"),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("byref_compiletime")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),a("span",{attrs:{class:"token variable"}},[s._v("$a")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token variable"}},[s._v("$a")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("' (modified by ref!)'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$foo")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'I am a string'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("//这个地方我们没有加&引用符")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("byref_compiletime")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$foo")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$foo")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("//输出 (modified by ref!)")]),s._v("\n\n")])])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("ZEND_FE")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("byref_compiletime"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" byref_compiletime_arginfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("byref_compiletime_arginfo")]),this._v("是一个"),t("code",[this._v("arginfo")]),this._v("结构体，我们在前面的章节中已经用过一次了。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" _zend_arg_info "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 参数的名称*/")]),s._v("\n    zend_uint name_len"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 参数名称的长度*/")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("class_name"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 类名 */")]),s._v("\n    zend_uint class_name_len"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 类名长度*/")]),s._v("\n    zend_bool array_type_hint"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 数组类型提示 */")]),s._v("\n    zend_bool allow_null"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 是否允许为NULL　*/")]),s._v("\n    zend_bool pass_by_reference"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 是否引用传递 */")]),s._v("\n    zend_bool return_reference"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 返回值是否为引用形式 */")]),s._v(" \n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" required_num_args"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \t\t"),a("span",{attrs:{class:"token comment"}},[s._v("/* 必要参数的数量 */")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" zend_arg_info"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_BEGIN_ARG_INFO(name, pass_rest_by_reference)\tZEND_BEGIN_ARG_INFO_EX(name, pass_rest_by_reference, ZEND_RETURN_VALUE, -1)")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_BEGIN_ARG_INFO_EX(name, pass_rest_by_reference, return_reference, required_num_args)\t\\\n\tstatic const zend_arg_info name[] = {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\t\t{ NULL, 0, NULL, 0, 0, 0, pass_rest_by_reference, return_reference, required_num_args },")]),s._v("\n\n\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_ARG_INFO(pass_by_ref, name)\t\t{ #name, sizeof(#name)-1, NULL, 0, 0, 0, pass_by_ref, 0, 0 },")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_ARG_PASS_INFO(pass_by_ref)\t\t\t{ NULL, 0, NULL, 0, 0, 0, pass_by_ref, 0, 0 },")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_ARG_OBJ_INFO(pass_by_ref, name, classname, allow_null) { #name, sizeof(#name)-1, #classname, sizeof(#classname)-1, 0, allow_null, pass_by_ref, 0, 0 },")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_ARG_ARRAY_INFO(pass_by_ref, name, allow_null) { #name, sizeof(#name)-1, NULL, 0, 1, allow_null, pass_by_ref, 0, 0 },")]),s._v("\n\n\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" ZEND_END_ARG_INFO()\t\t};")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("//这里我们先看")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_BEGIN_ARG_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pass_rest_by_reference"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_BEGIN_ARG_INFO_EX")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pass_rest_by_reference"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" return_reference"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("required_num_args"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("这两个宏函数的前两个参数的含义是一样的，name便是这个zend_arg_info数组变量的名字，这里我们定义它为：byref_compiletime_arginfo。pass_rest_by_reference如果被赋值为1，则代表着所有的参数默认都是需要以引用的方式传递的(在arginfo中单独声明的除外)。而对于ZEND_BEGIN_ARG_INFO_EX的后两个参数：\n"),t("ul",[t("li",[this._v("name和pass_rest_by_reference的含义同上。")]),this._v(" "),t("li",[this._v("return_reference：声明这个函数的返回值需要以引用的形式返回，这个参数已经在前面章节用过了。")]),this._v(" "),t("li",[this._v("required_num_args：函数被调用时，传递参数至少为前N个函数(也就是后面参数都有默认值)，当设置为-1时，必须传递所有参数")])]),this._v("\n接下来让我们看生成具体数据的宏：")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("ZEND_ARG_PASS_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("by_ref"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("//强制所有参数使用引用的方式传递")]),s._v("\n\n\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_ARG_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("by_ref"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("//如果by_ref为1，则名称为name的参数必须以引用的方式传递，")]),s._v("\n\n\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_ARG_ARRAY_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("by_ref"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" allow_null"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_ARG_OBJ_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("by_ref"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" classname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" allow_null"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n这两个宏实现了类型绑定，也就是说我们在传递某个参数时，必须是数组类型或者某个类的实例。如果最后的参数为真，则除了绑定的数据类型，还可以传递一个"),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),s._v("数据。\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("//我们组合起来使用：")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_BEGIN_ARG_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("byref_compiletime_arginfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("ZEND_ARG_PASS_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_END_ARG_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("ifdef")]),s._v(" ZEND_ENGINE_2")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("ZEND_BEGIN_ARG_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("byref_compiletime_arginfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("ZEND_ARG_PASS_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("ZEND_END_ARG_INFO")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("else")]),s._v(" ")]),a("span",{attrs:{class:"token comment"}},[s._v("/* ZE 1 */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" byref_compiletime_arginfo"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("   "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" BYREF_FORCE "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("ZEND_FALIAS")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("byref_compiletime"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("byref_calltime"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("byref_compiletime_arginfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"links"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#links","aria-hidden":"true"}},[this._v("#")]),this._v(" links")])}],!1,null,null,null);e.options.__file="6.2.md";t.default=e.exports}}]);