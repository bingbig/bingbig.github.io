(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{183:function(s,t,a){s.exports=a.p+"assets/img/syslog_1.d8d1be0a.png"},184:function(s,t,a){s.exports=a.p+"assets/img/syslog_2.b32866ad.png"},185:function(s,t,a){s.exports=a.p+"assets/img/inetd.d61e99ad.png"},280:function(s,t,a){"use strict";a.r(t);var n=[function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"守护进程和inetd超级服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#守护进程和inetd超级服务器","aria-hidden":"true"}},[s._v("#")]),s._v(" 守护进程和inetd超级服务器")]),s._v(" "),n("p",[s._v("守护进程（daemon）是在后台运行且不与任何终端关联的进程。守护进程通常没有控制终端，为了避免与作业控制、终端会话管理等发生不期望的任何交互，也为了避免非预期的输出到终端。")]),s._v(" "),n("p",[s._v("因为守护进程没有控制终端，因此需要专门的方法来输出守护进程产生的消息。"),n("code",[s._v("syslog")]),s._v("函数是输出这些消息的标准方法，它把这些消息发送给"),n("code",[s._v("syslogd")]),s._v("守护进程。")]),s._v(" "),n("h2",{attrs:{id:"syslogd守护进程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#syslogd守护进程","aria-hidden":"true"}},[s._v("#")]),s._v(" syslogd守护进程")]),s._v(" "),n("p",[s._v("Unix系统中的syslog通常随着系统的初始化脚本而启动，而且在系统运行期间一直运行。源自Berkeley的syslogd实现在启动时通常会执行以下操作：")]),s._v(" "),n("ol",[n("li",[s._v("读取配置文件（/etc/syslog.conf），指定本进程如何处理各种日志消息，如写到控制台或者转发到另一台主机上的syslogd进程；")]),s._v(" "),n("li",[s._v("创建Unix域套接字，给它捆绑路径名/var/run/log(在某些系统上是/dev/log)；")]),s._v(" "),n("li",[s._v("创建UDP套接字，绑定514端口；")]),s._v(" "),n("li",[s._v("打开路径名/dev/klog。来自内核的任何出错消息都会作为这个设备的输入。")])]),s._v(" "),n("p",[s._v("此后syslogd守护进程在一个无限循环中运行：调用select等待2，3，4步描述符之一变得可读，读入日志消息，并按照配置文件进行处理。如果守护进程收到"),n("code",[s._v("SIGHUP")]),s._v("信号，那就重新读取配置文件。")]),s._v(" "),n("h2",{attrs:{id:"syslog-函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#syslog-函数","aria-hidden":"true"}},[s._v("#")]),s._v(" syslog 函数")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<syslog.h>")])]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("syslog")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" priority"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("message"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("syslog是守护进程登记消息的常用技巧。")]),s._v(" "),n("p",[n("code",[s._v("priority")]),s._v("是"),n("code",[s._v("级别（level）")]),s._v("和"),n("code",[s._v("设施（facility）")]),s._v("两者的结合。级别默认为"),n("code",[s._v("LOG_NOTICE")]),s._v("。设施默认为"),n("code",[s._v("LOG_USER")]),s._v("。")]),s._v(" "),n("h4",{attrs:{id:"日志消息级别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日志消息级别","aria-hidden":"true"}},[s._v("#")]),s._v(" 日志消息级别")]),s._v(" "),n("p",[n("img",{attrs:{src:a(183),alt:"级别"}})]),s._v(" "),n("h4",{attrs:{id:"日志消息设施"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日志消息设施","aria-hidden":"true"}},[s._v("#")]),s._v(" 日志消息设施")]),s._v(" "),n("p",[n("img",{attrs:{src:a(184),alt:"设施"}})]),s._v(" "),n("p",[n("code",[s._v("messsage")]),s._v("参数类似于"),n("code",[s._v("printf")]),s._v("的格式串，不过增设了"),n("code",[s._v("%m")]),s._v("规范，它将被替换成与当前"),n("code",[s._v("error")]),s._v("值对应的出错消息。message参数的末尾可以出现一个换行符，不过并非必须。")]),s._v(" "),n("p",[s._v("当syslog被首次调用时，它创建一个UNIX域套接字，然后调用connect函数连接到syslogd守护进程创建的域套接字的众所周知路径名（譬如/var/run/log）。这个套接字一直打开，直到进程终止为止。进程也可以通过"),n("code",[s._v("openlog")]),s._v("和"),n("code",[s._v("closelog")]),s._v("来代替。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<syslog.h>")])]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("openlog")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ident"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" options"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" family"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("closelog")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("openlog可以在首次调用syslog前调用，closelog可以在应用进程不再发送日志消息时调用。"),n("code",[s._v("ident")]),s._v("通常是程序名，是syslog加在每条日志消息之前的字符串。"),n("code",[s._v("options")]),s._v("参数由下表所示的一个或多个常值的逻辑或构成。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[s._v("options")]),s._v(" "),n("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("LOG_CONS")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("若无法发送到syslogd守护进程则登记到控制台")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("LOG_NDELAY")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("不延迟打开，立即创建套接字。默认在首次调用syslog时创建")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("LOG_PERROR")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("既发送到syslogd，又登记到标准错误输出")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("LOG_PID")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("随着每个日志消息登记进程ID")])])])]),s._v(" "),n("h3",{attrs:{id:"守护进程例子"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#守护进程例子","aria-hidden":"true"}},[s._v("#")]),s._v(" 守护进程例子")]),s._v(" "),n("h4",{attrs:{id:"unp-h"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#unp-h","aria-hidden":"true"}},[s._v("#")]),s._v(" unp.h")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br")]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<stdlib.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<stdarg.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<arpa/inet.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<string.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<unistd.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<sys/socket.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<syslog.h>")])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<fcntl.h>")])]),s._v("\n\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" MAX_BUFF_SIZE   1024")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" LISTENQ 5")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" MAX_FD_SIZE 64")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" is_daemon_proc"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("err_msg")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" va_list"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("err_printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token function"}},[s._v("host_serv")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tcp_connect")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tcp_listen")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("udp_client")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("udp_connect")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("udp_server")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("daemon_init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h4",{attrs:{id:"daemon-c"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#daemon-c","aria-hidden":"true"}},[s._v("#")]),s._v(" daemon.c")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")])]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unp.h"')])]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("daemon_init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("pname"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" facility"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    pid_t pid"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/* 退出父进程，留下子进程继续运行 */")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("fork")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"parent process exited\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("exit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/* 创建一个新的session。当前进程称为新会话的会话头进程以及新进程组的进程组头进程，从而不再有控制终端 */")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("setsid")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/**\n     * 忽略SIGHUP并再次fork\n     * 再次fork的目的是确保本守护进程将来即使打开了一个终端设备，也不会自动获得控制终端。当没有控制终端的一个\n     * 会话头进程打开了一个终端设备时会自动成为这个会话头进程的控制终端。再次调用fork之后我们确保新的子进程不\n     * 再是一个会话头进程，从而不能自动获得一个控制终端。当会话头进程终止时，其会话中的所有进程都会收到SIHUP信号。\n     */")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("signal")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SIGHUP"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SIG_IGN"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("fork")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"1st child process exited\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Daemon process id is %d\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pid"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("exit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    is_daemon_proc "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/**\n     * 把工作目录改到根目录下。避免出现文件系统无法卸载的问题。\n     */")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("chdir")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"change workdir to root\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/**\n     * 关闭所有可能打开的描述符\n     */")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" MAX_FD_SIZE"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("close")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/**\n     * Presumably file descriptors 0, 1, and 2 have already been closed when this code executes, \n     * and there are no other threads which might be allocating new file descriptors. In this \n     * case, since open is required to always allocate the lowest available file descriptor \n     * number, these three calls to open will yield file descriptors 0, 1, and 2, unless they \n     * fail.\n     * \n     * https://stackoverflow.com/questions/4263173/redirecting-stdin-stdout-stderr-to-dev-null-in-c\n     */")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("open")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/dev/null"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" O_RDONLY"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("open")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/dev/null"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" O_RDWR"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("open")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/dev/null"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" O_RDWR"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("openlog")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pname"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LOG_PID"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" facility"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")])])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br")])]),n("h4",{attrs:{id:"unp-c"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#unp-c","aria-hidden":"true"}},[s._v("#")]),s._v(" unp.c")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unp.h"')])]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("err_msg")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" va_list ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buff"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("vsnprintf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAX_BUFF_SIZE"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("is_daemon_proc"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("syslog")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LOG_INFO"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"%s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buff"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("perror")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("err_printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    va_list ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("va_start")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("err_msg")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("va_end")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    va_list ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buff"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("va_start")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("err_msg")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fmt"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* we can pass the args only to functions that \n                        take va_args as argument. These have a v in \n                        their name: vprintf, vfprintf, vsnprintf */")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("va_end")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("exit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token function"}},[s._v("host_serv")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" family"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("bzero")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_flags "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AI_CANONNAME"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" family"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n *  创建一个TCP套接字并连接到服务器\n */")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tcp_connect")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ressave"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("bzero")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_STREAM"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"tcp_connect error for %s, %s: %s\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    ressave "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("socket")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("continue")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("connect")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("break")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* 成功 */")]),s._v("\n\n        "),n("span",{attrs:{class:"token function"}},[s._v("close")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"tcp_connect error for %s, %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ressave"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n * 创建一个TCP套接字并捆绑服务器的众所周知的端口，而接受外来的请求\n */")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tcp_listen")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("addrlenp"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" listend"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" on "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("bzero")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_flags "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AI_PASSIVE"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_STREAM"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"tcp_listen error for %s, %s: %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    _res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listend "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("socket")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend "),n("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("continue")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("setsockopt")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SOL_SOCKET"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SO_REUSEADDR"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("on"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("bind")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("break")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("close")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"tcp_listen error for %s, %s\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("listen")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LISTENQ"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* UDP套接字不需要调用listen，listen由TCP套接字调用，否则会报Operation not supported on socket错误 */")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addrlenp"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("addrlenp "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" listend"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n * 创建未连接的UDP套接字 \n */")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("udp_client")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("saptr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenp"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("bzero")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_DGRAM"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"udp_client error for %s, %s: %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    _res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("socket")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),n("span",{attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("break")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"udp_client error for %s, %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("saptr "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("malloc")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("memcpy")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("saptr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenp "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n * 创建已连接套接字。\n * （1）本函数相比udp_client不需要结尾两个参数，调用者可以改用write代替sendto，因此本函数不必返\n * 回一个套接字地址结构及其长度。\n * （2）本函数几乎等同于tcp_connect，差别之一在于UDP套接字上的connect调用不会发送任何东西到对端，\n * 如果存在错误（譬如对端不可达或所指定的端口上没有服务器），调用者就得等到向对端发送一个数据报\n * 之后才能发现。\n */")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("udp_connect")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"udp_connect error for %s, %s: %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    _res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("socket")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("continue")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("connect")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("break")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("close")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"udp connection error for %s, %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n * 为UDP服务器创建未连接套接字\n */")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("udp_server")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenptr"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("bzero")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_flags "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AI_PASSIVE"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_DGRAM"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"udp_server error for %s, %s: %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    _res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("socket")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("continue")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("bind")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("break")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{attrs:{class:"token function"}},[s._v("close")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"udp_server error for %s, %s"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lenptr"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenptr "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br"),n("span",{staticClass:"line-number"},[s._v("197")]),n("br"),n("span",{staticClass:"line-number"},[s._v("198")]),n("br"),n("span",{staticClass:"line-number"},[s._v("199")]),n("br"),n("span",{staticClass:"line-number"},[s._v("200")]),n("br"),n("span",{staticClass:"line-number"},[s._v("201")]),n("br"),n("span",{staticClass:"line-number"},[s._v("202")]),n("br"),n("span",{staticClass:"line-number"},[s._v("203")]),n("br"),n("span",{staticClass:"line-number"},[s._v("204")]),n("br"),n("span",{staticClass:"line-number"},[s._v("205")]),n("br"),n("span",{staticClass:"line-number"},[s._v("206")]),n("br"),n("span",{staticClass:"line-number"},[s._v("207")]),n("br"),n("span",{staticClass:"line-number"},[s._v("208")]),n("br"),n("span",{staticClass:"line-number"},[s._v("209")]),n("br"),n("span",{staticClass:"line-number"},[s._v("210")]),n("br"),n("span",{staticClass:"line-number"},[s._v("211")]),n("br"),n("span",{staticClass:"line-number"},[s._v("212")]),n("br"),n("span",{staticClass:"line-number"},[s._v("213")]),n("br"),n("span",{staticClass:"line-number"},[s._v("214")]),n("br"),n("span",{staticClass:"line-number"},[s._v("215")]),n("br"),n("span",{staticClass:"line-number"},[s._v("216")]),n("br"),n("span",{staticClass:"line-number"},[s._v("217")]),n("br"),n("span",{staticClass:"line-number"},[s._v("218")]),n("br"),n("span",{staticClass:"line-number"},[s._v("219")]),n("br"),n("span",{staticClass:"line-number"},[s._v("220")]),n("br"),n("span",{staticClass:"line-number"},[s._v("221")]),n("br"),n("span",{staticClass:"line-number"},[s._v("222")]),n("br"),n("span",{staticClass:"line-number"},[s._v("223")]),n("br"),n("span",{staticClass:"line-number"},[s._v("224")]),n("br"),n("span",{staticClass:"line-number"},[s._v("225")]),n("br"),n("span",{staticClass:"line-number"},[s._v("226")]),n("br"),n("span",{staticClass:"line-number"},[s._v("227")]),n("br"),n("span",{staticClass:"line-number"},[s._v("228")]),n("br"),n("span",{staticClass:"line-number"},[s._v("229")]),n("br"),n("span",{staticClass:"line-number"},[s._v("230")]),n("br"),n("span",{staticClass:"line-number"},[s._v("231")]),n("br"),n("span",{staticClass:"line-number"},[s._v("232")]),n("br"),n("span",{staticClass:"line-number"},[s._v("233")]),n("br"),n("span",{staticClass:"line-number"},[s._v("234")]),n("br"),n("span",{staticClass:"line-number"},[s._v("235")]),n("br"),n("span",{staticClass:"line-number"},[s._v("236")]),n("br"),n("span",{staticClass:"line-number"},[s._v("237")]),n("br"),n("span",{staticClass:"line-number"},[s._v("238")]),n("br"),n("span",{staticClass:"line-number"},[s._v("239")]),n("br")])]),n("h4",{attrs:{id:"tcp时间服务器守护进程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tcp时间服务器守护进程","aria-hidden":"true"}},[s._v("#")]),s._v(" TCP时间服务器守护进程")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unp.h"')])]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<time.h>")])]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("main")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" listenfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" connfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    socklen_t   len"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr_storage cliaddr"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" addrstr"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("64")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buff"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    time_t  ticks"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token function"}},[s._v("daemon_init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        listenfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tcp_listen")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("3")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        listenfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tcp_listen")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("err_quit")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"usage: daytimetcpsrv [<host>] <service or port>"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    \n    len "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cliaddr"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("for")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        connfd "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("accept")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listenfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("cliaddr"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("len"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connfd "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("continue")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        ticks "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("time")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("snprintf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAX_BUFF_SIZE"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"%.24s\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("ctime")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("ticks"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("write")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buff"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("strlen")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("close")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connfd"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h4",{attrs:{id:"编译-makefile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译-makefile","aria-hidden":"true"}},[s._v("#")]),s._v(" 编译 Makefile")]),s._v(" "),n("div",{staticClass:"language-makefile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-makefile"}},[n("code",[n("span",{attrs:{class:"token symbol"}},[s._v("unp.o")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unp.c\n\t"),n("span",{attrs:{class:"token variable"}},[s._v("$")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -c "),n("span",{attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n\n"),n("span",{attrs:{class:"token symbol"}},[s._v("daemon.o")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" daemon.c\n\t"),n("span",{attrs:{class:"token variable"}},[s._v("$")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -c "),n("span",{attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n\n"),n("span",{attrs:{class:"token symbol"}},[s._v("daytimetcpsrv.o")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" daytimetcpsrv.c\n\t"),n("span",{attrs:{class:"token variable"}},[s._v("$")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -c "),n("span",{attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n\n"),n("span",{attrs:{class:"token symbol"}},[s._v("server")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" daytimetcpsrv.o unp.o daemon.o\n\t"),n("span",{attrs:{class:"token variable"}},[s._v("$")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -o "),n("span",{attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),n("span",{attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n\n"),n("span",{attrs:{class:"token builtin"}},[s._v(".PHONY")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all clean\n\n"),n("span",{attrs:{class:"token symbol"}},[s._v("all")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" server\n\n"),n("span",{attrs:{class:"token symbol"}},[s._v("clean")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -rf *.o *.gch server\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h2",{attrs:{id:"inetd-守护进程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inetd-守护进程","aria-hidden":"true"}},[s._v("#")]),s._v(" inetd 守护进程")]),s._v(" "),n("p",[s._v("4.3BSD版本通过提供一个因特网超级服务器（即"),n("code",[s._v("inetd")]),s._v("守护进程）使上述问题得到简化。基于TCP或UDP的服务器都可以使用这个守护进程。它：")]),s._v(" "),n("ol",[n("li",[s._v("通过由inetd处理普通守护进程的大部分启动细节以简化守护进程的编写")]),s._v(" "),n("li",[s._v("单个进程就能为多个服务等待外来的客户请求，以此取代每个服务一个进程的做发，减少了系统的进程总数。")])]),s._v(" "),n("p",[s._v("inetd读入并处理自己的配置文件（通常是/etc/inetd.conf），配置指定了本超级服务器处理哪些服务以及当一个服务请求达到时该怎么做。其工作流程如下图：\n"),n("img",{attrs:{src:a(185),alt:"inetd工作流程"}})])])}],r=a(0),e=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);e.options.__file="daemon_inetd.md";t.default=e.exports}}]);