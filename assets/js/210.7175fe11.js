(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{277:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"名字与地址的转换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#名字与地址的转换","aria-hidden":"true"}},[s._v("#")]),s._v(" 名字与地址的转换")]),s._v(" "),a("p",[s._v("域名系统（Domain Name System， DNS）主要用于主机名字与IP地址之间的映射。主机名既可以是一个简单的名字，如bingbig，也可以是一个全限定名（Fully Qualified Domain Name， FQDN），如www.weibo.com。严格的来说FQDN必须一个点号结尾。")]),s._v(" "),a("p",[s._v("DNS中的条目称为资源记录（Resource Record，RR），我们感兴趣的RR类型只有几个，如下：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("A")])])]),s._v(" "),a("p",[s._v("A记录把主机名映射成一个32位的IPv4地址，如 "),a("code",[s._v("bingbig 12.111.23.23")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("AAAA")])])]),s._v(" "),a("p",[s._v("称为“四A”（quad A）记录的AAAA记录把一个主机名映射成一个128位的IPv6地址。是32位地址的4倍。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("PTR")])])]),s._v(" "),a("p",[s._v("称为“指针记录”（pointer record）的PTR记录把IP地址映射成主机名。对于IPv4地址，32位地址的4个字节反转顺序，每个字节都转换成各自的十进制ASCII值（0~255）后，再添上"),a("code",[s._v("in-addr.arpa")]),s._v("，结果字符串用于PTR查询。相应的IPv6地址，反转后每个四位组都被转换成十六进制的ASCII值（0~9，a~f），再添上"),a("code",[s._v("ip6.arpa")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("MX")])])]),s._v(" "),a("p",[s._v("MX记录把一个主机指定作为给定主机的“邮件交换器“（mail exchanger）。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("CNAME")])])]),s._v(" "),a("p",[s._v("CNAME代表“canonical name”（规范名字），它的常见用法是为常用的服务（例如ftp，www）指派CNAME记录。如果人们使用这些服务名而不是真实的主机名，那么相应得服务挪到另一个主机时他们也不知道。")]),s._v(" "),a("p",[s._v("每个支机构往往运行着一个或多个"),a("code",[s._v("名字服务器（name server）")]),s._v("，我们通过调用称为"),a("code",[s._v("解析器（resolve）")]),s._v("的函数库中的函数结束DNS服务器。解析器通过读取其系统相关配置文件确定本组织机构的名字服务器们的所在位置，文件"),a("code",[s._v("/etc/resolve.conf")]),s._v("通过包含本地名字服务器主机的IP地址。")]),s._v(" "),a("p",[s._v("不适用DNS也能获取名字和地址信息，常用的替代方法有静态机主文件（通常是"),a("code",[s._v("/etc/hosts")]),s._v("）、网络信息系统（Network Information System， NIS）以及轻权目录访问权限（Lightweight Directory Access Protocol， LDAP）。对于应用程序开发人员来说这些通常是透明的，我们只需要调用诸如"),a("code",[s._v("gethostbyname")]),s._v("和"),a("code",[s._v("gethostbyaddr")]),s._v("这样的解析器函数。")]),s._v(" "),a("h2",{attrs:{id:"gethostbyname函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gethostbyname函数","aria-hidden":"true"}},[s._v("#")]),s._v(" gethostbyname函数")]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("从POSIX规范中撤销该函数意在声明新的程序不再使用它，我们鼓励在新的程序中改用"),a("code",[s._v("getaddrinfo")]),s._v("函数。")])]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("gethostname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("hostname"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/** 返回： 若成功则为非空指针，若出错则为NULL且设置h_errno **/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("本函数返回的非空指针指向如下的hostent结构。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("h_name"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),a("span",{attrs:{class:"token comment"}},[s._v("/** CNAME **/")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("h_aliases"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{attrs:{class:"token comment"}},[s._v("/** 指向别名指针数组的指针 **/")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" h_addrtype"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{attrs:{class:"token comment"}},[s._v("/** 主机地址类型：AF_INET **/")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" h_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),a("span",{attrs:{class:"token comment"}},[s._v("/** 地址长度： 4 **/")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("h_addr_list"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/** 指向IPv4地址指针的指针 **/")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("gethostbyname发生错误时，它不设置errno变量，而是将全局整数变量h_errno设置为定义在<netdb.h>中的下列常值："),a("code",[s._v("HOST_NOT_FOUND")]),s._v(", "),a("code",[s._v("TRY_AGAIN")]),s._v(", "),a("code",[s._v("NO_RECOVERY")]),s._v(", "),a("code",[s._v("NO_DATA")]),s._v("（等同于"),a("code",[s._v("NO_ADDRESS")]),s._v("）。")]),s._v(" "),a("h4",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子","aria-hidden":"true"}},[s._v("#")]),s._v(" 例子")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<stdlib.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<stdarg.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<arpa/inet.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" MAX_BUFF_SIZE   1024")]),s._v("\n\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("err_sys")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("x"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("perror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("exit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("err_msg")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    va_list ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buff"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("va_start")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("vsnprintf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("perror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("va_end")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"unp.h"')])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("main")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("pptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("hptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" str"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INET6_ADDRSTRLEN"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v("argc"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("gethostbyname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{attrs:{class:"token function"}},[s._v("err_printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"gethostname error for host: %s: %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("hstrerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h_errno"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("continue")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),a("span",{attrs:{class:"token function"}},[s._v("printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"official hostname: %s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" hptr"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("h_name"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" hptr"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("h_aliases"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("pptr "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v("pptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token function"}},[s._v("printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"\\t alias: %s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("pptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        \n        "),a("span",{attrs:{class:"token keyword"}},[s._v("switch")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hptr"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("h_addrtype"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("case")]),s._v(" AF_INET"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                pptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" hptr"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("h_addr_list"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("pptr"),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v("pptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{attrs:{class:"token function"}},[s._v("printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"\\taddress: %s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("inet_ntop")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hptr"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("h_addrtype"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("pptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" str"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n            "),a("span",{attrs:{class:"token keyword"}},[s._v("default")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"unknown address type"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("h2",{attrs:{id:"gethostbyaddr函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gethostbyaddr函数","aria-hidden":"true"}},[s._v("#")]),s._v(" gethostbyaddr函数")]),s._v(" "),a("p",[a("code",[s._v("gethostaddr")]),s._v("函数试图由一个二进制IP地址找到相应的主机名，与gethostbyname的行为刚好相反。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("gethostbyaddr")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t len"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" family"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/** 返回：若成功则返回非空指针，若出错则为NULL且设置h_errno **/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"getservbyname-函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getservbyname-函数","aria-hidden":"true"}},[s._v("#")]),s._v(" getservbyname 函数")]),s._v(" "),a("p",[s._v("通常"),a("code",[s._v("/etc/service")]),s._v("文件保存了名字到端口的映射关系。"),a("code",[s._v("getservbyname")]),s._v("函数用于给定的名字查找相应的服务。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" servent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("getservbyname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("servname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("protoname"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/** 返回：若成功则返回非空指针，若出错则为NULL **/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("本函数返回的非空指针指向如下的servent结构：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" servent "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("s_name"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),a("span",{attrs:{class:"token comment"}},[s._v("/* 官方的服务名 */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("s_aliases"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{attrs:{class:"token comment"}},[s._v("/* alias数组 */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" s_port"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         "),a("span",{attrs:{class:"token comment"}},[s._v("/* 端口号，网络字节序 */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("s_proto"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{attrs:{class:"token comment"}},[s._v("/* 使用的协议 */")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"典型调用方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#典型调用方法","aria-hidden":"true"}},[s._v("#")]),s._v(" 典型调用方法")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" servent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"domain"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"udp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"ftp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"tcp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"ftp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyname")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"ftp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "udp'),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"getservbyport-函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getservbyport-函数","aria-hidden":"true"}},[s._v("#")]),s._v(" getservbyport 函数")]),s._v(" "),a("p",[a("code",[s._v("getservbyport")]),s._v("用于根据给定的端口号和可选协议查找相应的服务。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" servent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("getservbyport")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" port"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("protoname"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/** 返回：若成功则为非空指针，若出错则为NULL **/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("code",[s._v("port")]),s._v("参数必须为网络字节序。")]),s._v(" "),a("h4",{attrs:{id:"典型调用方法-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#典型调用方法-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 典型调用方法")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" servent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyport")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("htons")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("53")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"udp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyport")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("htons")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("21")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"tcp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyport")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("htons")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("21")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getservbyport")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("htons")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("21")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"udp"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"getaddrinfo函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getaddrinfo函数","aria-hidden":"true"}},[s._v("#")]),s._v(" getaddrinfo函数")]),s._v(" "),a("p",[s._v("gethostbyname和gethostbyadde这两个函数仅仅支持IPv4。geaddrinfo函数能够处理名字到地址以及服务到端口的这两种转换，返回的是一个sockaddr结构而不是一个地址列表。它把协议相关性隐藏在这个库函数内部。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("hostname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("service"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" strcut addrinfo "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("result"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/** 返回： 若成功则为0， 若出错则非0 **/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"result"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#result","aria-hidden":"true"}},[s._v("#")]),s._v(" result")]),s._v(" "),a("p",[s._v("本函数通过result指针参数返回一个指向addrinfo结构链表的指针，addrinfo结构定义在头文件"),a("code",[s._v("netdb.h")]),s._v("中：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v("         ai_flags"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),a("span",{attrs:{class:"token comment"}},[s._v("/* AI_PASSIVE, AI_CANONNAME等 */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v("         ai_family"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{attrs:{class:"token comment"}},[s._v("/* AF_XXX 地址族 */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v("         ai_socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{attrs:{class:"token comment"}},[s._v("/* SOCK_XXX */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v("         ai_protocol"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{attrs:{class:"token comment"}},[s._v("/* 0 or IPPROTO_XXX for IPv4 and IPv6 */")]),s._v("\n    socklen_t   ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{attrs:{class:"token comment"}},[s._v("/* ai_addr的长度 */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v("        "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ai_cannoname"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{attrs:{class:"token comment"}},[s._v("/* ptr to cannonical name for host，在第一个结构有值，其他结构中为NULL */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ai_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{attrs:{class:"token comment"}},[s._v("/* ptr to socket address structure */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ai_next"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{attrs:{class:"token comment"}},[s._v("/* ptr to next structure in linked list */")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hostname","aria-hidden":"true"}},[s._v("#")]),s._v(" hostname")]),s._v(" "),a("p",[s._v("hostname参数是一个主机名或地址串，IPv4的点分十进制数串或者IPv6的十六进制数串。")]),s._v(" "),a("h4",{attrs:{id:"service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service","aria-hidden":"true"}},[s._v("#")]),s._v(" service")]),s._v(" "),a("p",[s._v("service参数是一个服务名或十进制端口号数串。")]),s._v(" "),a("h4",{attrs:{id:"hints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hints","aria-hidden":"true"}},[s._v("#")]),s._v(" hints")]),s._v(" "),a("p",[s._v("hints参数可是一个空指针，也可以是一个指向某个addrinfo结构的指针，调用者在这个结构中填入关于期望返回的信息类型的暗示。hints结构中调用者可以设置的成员有：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ai_flags")])]),s._v(" "),a("li",[a("code",[s._v("ai_family")])]),s._v(" "),a("li",[a("code",[s._v("ai_socktype")])]),s._v(" "),a("li",[a("code",[s._v("ai_protocol")])])]),s._v(" "),a("p",[s._v("其中ai_flags成员可用的标志值及其含义如下：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("AI_PASSIVE")]),s._v("            套接字将用于被动打开")]),s._v(" "),a("li",[a("code",[s._v("AI_CANONNAME")]),s._v("          告知getaddrinfo函数返回主机的规范名字")]),s._v(" "),a("li",[a("code",[s._v("AI_NUMERICHOST")]),s._v("        防止任何类型的名字到地址映射，hostname参数必须是一个地址串。")]),s._v(" "),a("li",[a("code",[s._v("AI_NUMERICSERV")]),s._v("        防止任何类型的名字到服务映射，service参数必须是一个十进制端口号数串。")])]),s._v(" "),a("p",[s._v("其他标志值如"),a("code",[s._v("AI_V4MAPPED")]),s._v(", "),a("code",[s._v("AI_ALL")]),s._v(", "),a("code",[s._v("AI_ADDRCONFIG")]),s._v("。")]),s._v(" "),a("blockquote",[a("p",[s._v("如果hints参数是一个空指针，本函数就假设ai_flag、ai_socktype和ai_protocol的值均为0，ai_family的值为"),a("code",[s._v("AF_UNSPEC")]),s._v("。")])]),s._v(" "),a("h4",{attrs:{id:"说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#说明","aria-hidden":"true"}},[s._v("#")]),s._v(" 说明")]),s._v(" "),a("p",[s._v("如果本函数成功返回，即返回0，那么由result参数指向的变量已被填入一个指针，它指向的是addrinfo结构链表（通过ai_next成员串联）。可以导致返回多个addrinfo结构的情形有以下两个：")]),s._v(" "),a("ol",[a("li",[s._v("如果与hostname参数关联的地址有多个，那么适用于所请求地址族（hints结构的ai_family成员设置）的每个地址都返回一个对应的结构。")]),s._v(" "),a("li",[s._v("如果service参数所指定的服务支持多个套接字类型，那么每个套接字类型都可以返回一个对应的结构，具体取决于hints结构的ai_socktype成员。")])]),s._v(" "),a("p",[s._v("如果在hints结构中设置了AI_CANONNAME标志，那么本函数返回的一个addrinfo结构的ai_cannoname成员指向所查找主机的规范名字。")]),s._v(" "),a("p",[s._v("getaddrinfo有多种输入，有些是无效的，有些事没有多大意义的，下面只看一些常见的输入。")]),s._v(" "),a("ul",[a("li",[s._v("指定hostname和service。这是TCP或UDP客户端进程调用getaddrinfo的常规输入。")]),s._v(" "),a("li",[s._v("典型的服务器进程只指定service而不指定hostname，同事在hints结构中指定AI_PASSIVE标志。返回的套接字地址结构中应含有一个值为"),a("code",[s._v("INADDR_ANY（对于IPv4）")]),s._v("或"),a("code",[s._v("IN6ADDR_ANY_INIT（对于IPv6）")]),s._v("的IP地址。")])]),s._v(" "),a("h4",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意","aria-hidden":"true"}},[s._v("#")]),s._v(" 注意")]),s._v(" "),a("ol",[a("li",[s._v("getaddrinfo处理两个不同的输入：（1）套接字地址结构类型，调用者期待返回的地址结构符合这个类型；（2）资源记录类型，在DNS或者其他数据库中执行的查找符合这个类型。")]),s._v(" "),a("li",[s._v("在hints结构中的执行的返回的套接字地址结构的类型。如果指定了AF_INET，函数就不会返回sockaddr_in6结构，同样如果指定了AF_INET6，就不能返回sockaddr_in结构。")]),s._v(" "),a("li",[s._v("如果指定了AF_UNSPEC，函数返回的是适用于指定主机名和服务名且适合任意协议族的地址。这就意味着如果主机既有AAAA记录又有A记录，那么AAAA记录将作为sockaddr_in6结构返回，A记录将作为sockaddr_in结构返回。")]),s._v(" "),a("li",[s._v("如果设置了AI_PASSIVE标志但是没有指定主机名，那么IPv6统配地址（IN……ADDR_ANY_INIT或0::0）应该作为sockaddr_in6结构返回，通过IPv4通配地址（INADDR_ANY或0.0.0.0）应该作为sockaddr_in结构返回。")]),s._v(" "),a("li",[s._v("在hints结构的ai_family成员中指定的地址族以及ai_flags成员中指定的AI_V4MAPPED和AI_ALL等标志决定了在DNS中查找的资源记录类型（A和/或AAAA），也决定了返回地址的类型（IPv4、IPv6和/或IPv4映射的IPv6）。")]),s._v(" "),a("li",[s._v("主机名参数还可以是IPv6的十六进制数串或IPv4的点分十进制数串。有效性取决于指定的地址族。")])]),s._v(" "),a("h2",{attrs:{id:"gai-strerror函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gai-strerror函数","aria-hidden":"true"}},[s._v("#")]),s._v(" gai_strerror函数")]),s._v(" "),a("p",[s._v("gai_strerror函数以getaddrinfo返回的非0错误值为参数，返回一个指向对应的出错信息串的指针。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" error"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/* 返回：指向错误信息的消息字符串的指针 */")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("表：getaddrinfo返回的非0错误常值")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("常值")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("EAI_AGAIN")]),s._v(" "),a("td",[s._v("名字解析中的临时失败")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_BADFLAGS")]),s._v(" "),a("td",[s._v("ai_flags的值无效")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_FAIL")]),s._v(" "),a("td",[s._v("名字解析中的不可恢复地失败")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_FAMILY")]),s._v(" "),a("td",[s._v("不支持ai_family")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_MEMORY")]),s._v(" "),a("td",[s._v("内存分配失败")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_NONAME")]),s._v(" "),a("td",[s._v("hostname或service未提供，或者不可知")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_OVERFLOW")]),s._v(" "),a("td",[s._v("用户参数缓冲区溢出(仅限于getnameinfo()函数)")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_SERVICE")]),s._v(" "),a("td",[s._v("不支持ai_socktype类型的service")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_SOCKTYPE")]),s._v(" "),a("td",[s._v("不支持ai_socktype")])]),s._v(" "),a("tr",[a("td",[s._v("EAI_SYSTEM")]),s._v(" "),a("td",[s._v("在errno变量中有系统错误返回")])])])]),s._v(" "),a("h2",{attrs:{id:"freeaddrinfo函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#freeaddrinfo函数","aria-hidden":"true"}},[s._v("#")]),s._v(" freeaddrinfo函数")]),s._v(" "),a("p",[s._v("有getaddrinfo返回的所有存储空间都是动态获取的，包括addrinfo结构，ai_addr结构和ai_cannoname字符串。通过调用freeaddrinfo返回给系统。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ai"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"例子-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 例子")]),s._v(" "),a("h4",{attrs:{id:"头文件unp-h"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#头文件unp-h","aria-hidden":"true"}},[s._v("#")]),s._v(" 头文件unp.h")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<stdlib.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<stdarg.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<arpa/inet.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<string.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<unistd.h>")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<sys/socket.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" MAX_BUFF_SIZE   1024")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" LISTENQ 5")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("err_msg")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" va_list ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buff"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("vsnprintf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("perror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("err_printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    va_list ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("va_start")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("err_msg")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("va_end")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    va_list ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buff"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("va_start")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("err_msg")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fmt"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/* we can pass the args only to functions that \n                        take va_args as argument. These have a v in \n                        their name: vprintf, vfprintf, vsnprintf */")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("va_end")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ap"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("exit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("host_serv")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" family"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("bzero")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_flags "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AI_CANONNAME"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" family"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/**\n *  创建一个TCP套接字并连接到服务器\n */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("tcp_connect")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ressave"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("bzero")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_STREAM"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"tcp_connect error for %s, %s: %s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    ressave "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("socket")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("continue")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("connect")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/* 成功 */")]),s._v("\n        \n        "),a("span",{attrs:{class:"token function"}},[s._v("close")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"tcp_connect error for %s, %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ressave"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/**\n * 创建一个TCP套接字并捆绑服务器的众所周知的端口，而接受外来的请求\n */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("tcp_listen")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("addrlenp"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" listend"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("bzero")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_flags "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AI_PASSIVE"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_STREAM"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"tcp_listen error for %s, %s: %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    _res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listend "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("socket")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("continue")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("setsockopt")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SOL_SOCKET"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SO_REUSEADDR"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("on"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("bind")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("close")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"tcp_listen error for %s, %s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("listen")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("listend"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LISTENQ"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/* UDP套接字不需要调用listen，listen由TCP套接字调用，否则会报Operation not supported on socket错误 */")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addrlenp"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("addrlenp "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" listend"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/**\n * 创建未连接的UDP套接字 \n */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("udp_client")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("saptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenp"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("bzero")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_DGRAM"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"udp_client error for %s, %s: %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    _res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("socket")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),a("span",{attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"udp_client error for %s, %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("saptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("malloc")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("memcpy")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("saptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenp "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/**\n * 创建已连接套接字。\n * （1）本函数相比udp_client不需要结尾两个参数，调用者可以改用write代替sendto，因此本函数不必返\n * 回一个套接字地址结构及其长度。\n * （2）本函数几乎等同于tcp_connect，差别之一在于UDP套接字上的connect调用不会发送任何东西到对端，\n * 如果存在错误（譬如对端不可达或所指定的端口上没有服务器），调用者就得等到向对端发送一个数据报\n * 之后才能发现。\n */")]),s._v(" \n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("udp_connect")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"udp_connect error for %s, %s: %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    _res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("socket")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("continue")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("connect")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("close")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"udp connection error for %s, %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/**\n * 为UDP服务器创建未连接套接字\n */")]),s._v(" \n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("udp_server")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token function"}},[s._v("bzero")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_flags "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AI_PASSIVE"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_family "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_UNSPEC"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ai_socktype "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOCK_DGRAM"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("hints"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"udp_server error for %s, %s: %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("gai_strerror")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    _res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("socket")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_family"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_socktype"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_protocol"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("continue")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("bind")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("break")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),a("span",{attrs:{class:"token function"}},[s._v("close")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_next"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"udp_server error for %s, %s"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lenptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("lenptr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("ai_addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("freeaddrinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_res"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br"),a("span",{staticClass:"line-number"},[s._v("161")]),a("br"),a("span",{staticClass:"line-number"},[s._v("162")]),a("br"),a("span",{staticClass:"line-number"},[s._v("163")]),a("br"),a("span",{staticClass:"line-number"},[s._v("164")]),a("br"),a("span",{staticClass:"line-number"},[s._v("165")]),a("br"),a("span",{staticClass:"line-number"},[s._v("166")]),a("br"),a("span",{staticClass:"line-number"},[s._v("167")]),a("br"),a("span",{staticClass:"line-number"},[s._v("168")]),a("br"),a("span",{staticClass:"line-number"},[s._v("169")]),a("br"),a("span",{staticClass:"line-number"},[s._v("170")]),a("br"),a("span",{staticClass:"line-number"},[s._v("171")]),a("br"),a("span",{staticClass:"line-number"},[s._v("172")]),a("br"),a("span",{staticClass:"line-number"},[s._v("173")]),a("br"),a("span",{staticClass:"line-number"},[s._v("174")]),a("br"),a("span",{staticClass:"line-number"},[s._v("175")]),a("br"),a("span",{staticClass:"line-number"},[s._v("176")]),a("br"),a("span",{staticClass:"line-number"},[s._v("177")]),a("br"),a("span",{staticClass:"line-number"},[s._v("178")]),a("br"),a("span",{staticClass:"line-number"},[s._v("179")]),a("br"),a("span",{staticClass:"line-number"},[s._v("180")]),a("br"),a("span",{staticClass:"line-number"},[s._v("181")]),a("br"),a("span",{staticClass:"line-number"},[s._v("182")]),a("br"),a("span",{staticClass:"line-number"},[s._v("183")]),a("br"),a("span",{staticClass:"line-number"},[s._v("184")]),a("br"),a("span",{staticClass:"line-number"},[s._v("185")]),a("br"),a("span",{staticClass:"line-number"},[s._v("186")]),a("br"),a("span",{staticClass:"line-number"},[s._v("187")]),a("br"),a("span",{staticClass:"line-number"},[s._v("188")]),a("br"),a("span",{staticClass:"line-number"},[s._v("189")]),a("br"),a("span",{staticClass:"line-number"},[s._v("190")]),a("br"),a("span",{staticClass:"line-number"},[s._v("191")]),a("br"),a("span",{staticClass:"line-number"},[s._v("192")]),a("br"),a("span",{staticClass:"line-number"},[s._v("193")]),a("br"),a("span",{staticClass:"line-number"},[s._v("194")]),a("br"),a("span",{staticClass:"line-number"},[s._v("195")]),a("br"),a("span",{staticClass:"line-number"},[s._v("196")]),a("br"),a("span",{staticClass:"line-number"},[s._v("197")]),a("br"),a("span",{staticClass:"line-number"},[s._v("198")]),a("br"),a("span",{staticClass:"line-number"},[s._v("199")]),a("br"),a("span",{staticClass:"line-number"},[s._v("200")]),a("br"),a("span",{staticClass:"line-number"},[s._v("201")]),a("br"),a("span",{staticClass:"line-number"},[s._v("202")]),a("br"),a("span",{staticClass:"line-number"},[s._v("203")]),a("br"),a("span",{staticClass:"line-number"},[s._v("204")]),a("br"),a("span",{staticClass:"line-number"},[s._v("205")]),a("br"),a("span",{staticClass:"line-number"},[s._v("206")]),a("br"),a("span",{staticClass:"line-number"},[s._v("207")]),a("br"),a("span",{staticClass:"line-number"},[s._v("208")]),a("br"),a("span",{staticClass:"line-number"},[s._v("209")]),a("br"),a("span",{staticClass:"line-number"},[s._v("210")]),a("br"),a("span",{staticClass:"line-number"},[s._v("211")]),a("br"),a("span",{staticClass:"line-number"},[s._v("212")]),a("br"),a("span",{staticClass:"line-number"},[s._v("213")]),a("br"),a("span",{staticClass:"line-number"},[s._v("214")]),a("br"),a("span",{staticClass:"line-number"},[s._v("215")]),a("br"),a("span",{staticClass:"line-number"},[s._v("216")]),a("br"),a("span",{staticClass:"line-number"},[s._v("217")]),a("br"),a("span",{staticClass:"line-number"},[s._v("218")]),a("br"),a("span",{staticClass:"line-number"},[s._v("219")]),a("br"),a("span",{staticClass:"line-number"},[s._v("220")]),a("br"),a("span",{staticClass:"line-number"},[s._v("221")]),a("br"),a("span",{staticClass:"line-number"},[s._v("222")]),a("br"),a("span",{staticClass:"line-number"},[s._v("223")]),a("br"),a("span",{staticClass:"line-number"},[s._v("224")]),a("br"),a("span",{staticClass:"line-number"},[s._v("225")]),a("br"),a("span",{staticClass:"line-number"},[s._v("226")]),a("br"),a("span",{staticClass:"line-number"},[s._v("227")]),a("br"),a("span",{staticClass:"line-number"},[s._v("228")]),a("br"),a("span",{staticClass:"line-number"},[s._v("229")]),a("br"),a("span",{staticClass:"line-number"},[s._v("230")]),a("br"),a("span",{staticClass:"line-number"},[s._v("231")]),a("br"),a("span",{staticClass:"line-number"},[s._v("232")]),a("br"),a("span",{staticClass:"line-number"},[s._v("233")]),a("br"),a("span",{staticClass:"line-number"},[s._v("234")]),a("br"),a("span",{staticClass:"line-number"},[s._v("235")]),a("br"),a("span",{staticClass:"line-number"},[s._v("236")]),a("br"),a("span",{staticClass:"line-number"},[s._v("237")]),a("br"),a("span",{staticClass:"line-number"},[s._v("238")]),a("br"),a("span",{staticClass:"line-number"},[s._v("239")]),a("br")])]),a("h4",{attrs:{id:"客户端程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端程序","aria-hidden":"true"}},[s._v("#")]),s._v(" 客户端程序")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"unp.h"')])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("main")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sa"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    socklen_t salen"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" recvline"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc "),a("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"usage: daytimeudpcli <hostname/ip address> <services/port>"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("udp_client")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("sa"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("salen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" addrptr"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("128")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr_in "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sin "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr_in "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" sa"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"sending to %s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("inet_ntop")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AF_INET"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("sin"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("sin_addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addrptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addrptr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token function"}},[s._v("sendto")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('""')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sa"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" salen"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("recvfrom")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" recvline"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    recvline"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("n"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("fputs")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("recvline"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("stdout")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"服务端程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端程序","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务端程序")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"unp.h"')])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<time.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("main")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buff"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr_storage cliaddr"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    socklen_t len"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    time_t ticks"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("udp_server")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc "),a("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        sockfd "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("udp_server")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" argv"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("err_quit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"usage: daytimeudpsrv [<host>] <service or port>"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    len "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cliaddr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        n "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("recvfrom")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAX_BUFF_SIZE"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("cliaddr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("len"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("printf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"received a datagram with %d bytes\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ticks "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("time")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("snprintf")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"%.24s\\r\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("ctime")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("ticks"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("sendto")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("strlen")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buff"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" sockaddr "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("cliaddr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" len"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h2",{attrs:{id:"getnameinfo函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getnameinfo函数","aria-hidden":"true"}},[s._v("#")]),s._v(" getnameinfo函数")]),s._v(" "),a("p",[s._v("getnameinfo是getaddrinfo函数的互补函数。本函数以协议无关的方式提供主机和服务信息。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("getnameinfo")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" addrinfo "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sockaddr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t addrlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("host"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_t hostlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("serv"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" socklen_r servlen"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" flags"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("/* 返回：若成功则为0， 出错为非0  */")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"可重入函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可重入函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 可重入函数")]),s._v(" "),a("p",[s._v("gethostbyname是"),a("code",[s._v("不可重入（re-entrant）")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("由于历史的原因，"),a("code",[s._v("gethostbyname")]),s._v("，"),a("code",[s._v("gethostbyaddr")]),s._v("、"),a("code",[s._v("getservbyname")]),s._v("和"),a("code",[s._v("getservbyport")]),s._v("这几个函数是不可重入的，因为它们都返回指向同一个静态结构的指针。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("inet_pton")]),s._v(" 和 "),a("code",[s._v("inet_ntop")]),s._v(" 总是可重入的， "),a("code",[s._v("inet_ntoa")]),s._v(" 是不可重入的。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("getaddrinfo")]),s._v(" 可重入的前提是由它调用的函数都可重入。也就是说，它应该调用可重入版本的 "),a("code",[s._v("gethostbyname")]),s._v("（以解析主机名）和 "),a("code",[s._v("getservbyname")]),s._v("（以解析服务名），本函数返回的结果全部存放在动态分配的内存空间的原因之一就是允许它可重入。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("getnameinfo")]),s._v(" 可重入的前提是由它调用的函数都可以重入。也就是说，它应该调用可重入版本的 "),a("code",[s._v("gethosrbyaddr")]),s._v("（以反向解析主机名）和 "),a("code",[s._v("getservbyport")]),s._v("（以反向解析服务名）。它的两个结果字符串（分别为主机名和服务名）由调用者分配存储空间，从而允许它们可重入。")])])]),s._v(" "),a("h2",{attrs:{id:"gethostbyname-r和gethostbyaddr-r函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gethostbyname-r和gethostbyaddr-r函数","aria-hidden":"true"}},[s._v("#")]),s._v(" gethostbyname_r和gethostbyaddr_r函数")]),s._v(" "),a("p",[s._v("有两种方法把不可重入的函数改为可重入的函数：")]),s._v(" "),a("ol",[a("li",[s._v("把由不可重入函数填写并返回静态结构的做法改为由调用者分配再由可重入函数填写结构。")]),s._v(" "),a("li",[s._v("由可重入函数调用 "),a("code",[s._v("malloc")]),s._v("以动态分配内存空间。")])]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("<netdb.h>")])]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("gethostbyname_r")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("hostname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("result"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("buf"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" buflen"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("h_errnop"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token function"}},[s._v("gethostbyaddr_r")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("addr"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" type"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" hostent "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("result"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("buf"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" buflen"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("h_errnop"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("其中result参数由调用者分配并由被调用者填写的hostent结构。")])])}],!1,null,null,null);r.options.__file="names.md";t.default=r.exports}}]);