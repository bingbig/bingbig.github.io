(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{432:function(s,a,t){"use strict";t.r(a);var n=t(0),r=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("p",[s._v("[参考来源：未知]侵权请联系～")]),s._v(" "),t("h2",{attrs:{id:"服务器日志分析命令大全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器日志分析命令大全","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务器日志分析命令大全")]),s._v(" "),t("p",[s._v("分析日志可以帮助我们定量的了解服务器的运行状况以及网站的访问情况，帮助我们提高网站性能和安全性。比如说，缓存经常被访问的页面，优化经常查询的SQL等等。查看访问量和非法访问记录帮助我们提高安全性。")]),s._v(" "),t("p",[s._v("有些简短的命令经常用就能记住了，太长的可以直接复制粘贴～")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("查看有多少个IP访问：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" access_log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("查看某一个页面被访问的次数：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"/index.php"')]),s._v(" access_log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("查看每一个IP访问了多少个页面：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{++S["),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("]} END {for (a in S) print a,S[a]}'")]),s._v(" access_log "),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" log.txt\n"),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n -t "),t("span",{attrs:{class:"token string"}},[s._v("' '")]),s._v(" -k 2 log.txt "),t("span",{attrs:{class:"token comment"}},[s._v("# 配合sort进一步排序")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("将每个IP访问的页面数进行从小到大排序：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{++S["),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("]} END {for (a in S) print S[a],a}'")]),s._v(" log_file "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("查看某一个IP访问了哪些页面：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("\t"),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" ^111.111.111.111 access_log"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v(","),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("}'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("去掉搜索引擎统计的页面：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$12")]),s._v(","),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" access_log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(' ^\\"Mozilla '),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" \t"),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("查看2015年8月16日14时这一个小时内有多少IP访问:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$4")]),s._v(","),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" access_log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" 16/Aug/2015:14 "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("查看访问前十个ip地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -10 access_log\n\n"),t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -10 \n\n"),t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" '"),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("counts"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{attrs:{class:"token variable"}},[t("span",{attrs:{class:"token variable"}},[s._v("$(")]),s._v("11"),t("span",{attrs:{class:"token variable"}},[s._v(")")])]),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("+"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" END "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("for"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" counts"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" print counts"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("url"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", url"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n9. 访问次数最多的10个文件或页面\n\t```bash\n\tcat log_file|awk '{print $11}'|sort|uniq -c|sort -nr | head -10\n\n\tcat log_file|awk '{print $11}'|sort|uniq -c|sort -nr|head -20 \n\tawk '{print $1}' log_file |sort -n -r |uniq -c | \tsort -n -r | head -20 # 访问量最大的前20个ip\n\t```\n\t\n10. 通过子域名访问次数，依据referer来计算，稍有不准\n\t```bash\n\tcat access.log | awk '{print $11}' | sed -e ' s/http:\\/\\///' -e ' s/\\/.*//' | sort | uniq -c | sort -rn | head -20\n\t```\n\t\n11. 列出传输大小最大的几个文件\n\t```bash\n\tcat www.access.log |awk '($7~/\\.php/){print $10 \" \" $1 \" \" $4 \" \" $7}'|sort -nr|head -100\n\t```\n\t\n12. 列出输出大于200000byte(约200kb)的页面以及对应页面发生次数\n\t```bash\n\tcat www.access.log |awk '($10 > 200000 && $7~/\\.php/){print $7}'|sort -n|uniq -c|sort -nr|head -100\n\t```\n13. 如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面\n\t```bash\n\tcat www.access.log |awk '($7~/\\.php/){print $NF \" \" $1 \" \" $4 \" \" $7}'|sort -nr|head -100\n\t```\n\t\n14. 列出最最耗时的页面(超过60秒的)的以及对应页面发生次数\n\t```bash\n\tcat www.access.log |awk '($NF > 60 && $7~/\\.php/){print $7}'|sort -n|uniq -c|sort -nr|head -100\n\t```\n\t\n15. 列出传输时间超过 30 秒的文件\n\t```bash\n\tcat www.access.log |awk '($NF > 30){print $7}'|sort -n|uniq -c|sort -nr|head -20\n\t```\n\t\n16. 列出当前服务器每一进程运行的数量，倒序排列\n\t```bash\n\tps -ef | awk -F ' ' '{print $8 \" \" $9}' |sort | uniq -c |sort -nr |head -20\n\t```\n\t\n17. 查看apache当前并发访问数\n\t```bash\n\t#对比httpd.conf中MaxClients的数字差距多少。\n\tnetstat -an | grep ESTABLISHED | wc -l\n\t```\n\t\n18. 可以使用如下参数查看数据\n\t```bash\n\tps -ef|grep httpd|wc -l\n\t#1388\n\t#统计httpd进程数，连个请求会启动一个进程，使用于Apache服务器。\n\t\n\tnetstat -nat|grep -i \"80\"|wc -l\n\t#4341\n\t#netstat -an会打印系统当前网络链接状态，而grep -i \"80\"是用来提取与80端口有关的连接的，wc -l进行连接数统计。\n\t#最终返回的数字就是当前所有80端口的请求总数。\n\t\n\tnetstat -na|grep ESTABLISHED|wc -l\n\t#376\n\t#netstat -an会打印系统当前网络链接状态，而grep ESTABLISHED 提取出已建立连接的信息。 然后wc -l统计。\n\t#最终返回的数字就是当前所有80端口的已建立连接的总数。\n\t\n\tnetstat -nat||grep ESTABLISHED|wc\n\t#可查看所有建立连接的详细记录\n\t```\n19. 输出每个ip的连接数，以及总的各个状态的连接数\n\t```bash\n\tnetstat -n | awk '/^tcp/ {n=split($(NF-1),array,\":\");if(n<=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N} END {for(a in S){printf(\"%-20s %s\\n\", a, S[a]);++I}printf(\"%-20s %s\\n\",\"TOTAL_IP\",I);for(a in s) printf(\"%-20s %s\\n\",a, s[a]);printf(\"%-20s %s\\n\",\"TOTAL_LINK\",N);}'\n\t```\n20. 其他的收集\n\n分析日志文件下 2012-05-04 访问页面最高 的前20个 URL 并排序\n```bash\ncat access.log |grep '04/May/2012'| awk '{print $11}'|sort|uniq -c|sort -nr|head -20 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br")])]),t("p",[s._v("查询受访问页面的URL地址中 含有 www.abc.com 网址的 IP 地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access_log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'("),t("span",{attrs:{class:"token variable"}},[s._v("$11")]),s._v("~/\\www.abc.com/){print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("获取访问最高的10个IP地址 同时也可以按时间来查询")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -10 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("时间段查询日志时间段的情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'15/Aug/2015|16/Aug/2015'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("最耗时的一百个PHP页面")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'("),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("~/\\.php/){print "),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v(' " " '),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v(' " " '),t("span",{attrs:{class:"token variable"}},[s._v("$4")]),s._v(' " " '),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("列出最最耗时的页面(超过60秒的)的以及对应页面发生次数")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'("),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v(" > 60 && "),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("~/\\.php/){print "),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -100 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("统计网站流量（G)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{sum+="),t("span",{attrs:{class:"token variable"}},[s._v("$10")]),s._v("} END {print sum/1024/1024/1024}'")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("统计404的连接")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'("),t("span",{attrs:{class:"token variable"}},[s._v("$9")]),s._v(" ~/404/)'")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$9")]),s._v(","),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("统计http status.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{counts["),t("span",{attrs:{class:"token variable"}},[t("span",{attrs:{class:"token variable"}},[s._v("$(")]),s._v("9"),t("span",{attrs:{class:"token variable"}},[s._v(")")])]),s._v("]+=1}; END {for(code in counts) print code, counts[code]}'")]),s._v(" \n"),t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$9")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -rn\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("每秒并发：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("\"awk '{if("),t("span",{attrs:{class:"token variable"}},[s._v("$9")]),s._v("~/200|30|404/)COUNT["),t("span",{attrs:{class:"token variable"}},[s._v("$4")]),s._v("]++}END{for( a in COUNT) print a,COUNT[a]}' log_file|sort -k 2 -nr|head -n10\"")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("带宽统计")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{if("),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v('~/GET/) count++}END{print "client_request="count}\'')]),s._v(" \n"),t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{BYTE+="),t("span",{attrs:{class:"token variable"}},[s._v("$11")]),s._v('}END{print "client_kbyte_out="BYTE/1024"KB"}\'')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("找出某天访问次数最多的10个IP")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"20/Mar/2011"')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("当天ip连接数最高的ip都在干些什么:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"10.0.21.17"')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$8")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -n 10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("小时单位里ip连接数最多的10个时段")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" -vFS"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),t("span",{attrs:{class:"token string"}},[s._v('"[:]"')]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('\'{gsub("-.*","",'),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v(");num["),t("span",{attrs:{class:"token variable"}},[s._v("$2")]),s._v('" "'),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("]++}END{for(i in num)print i,num[i]}'")]),s._v(" log_file "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n -k 3 -r "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("找出访问次数最多的几个分钟")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" access.log "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"20/Mar/2011"')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("cut")]),s._v(" -c 14-18"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("取5分钟日志")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{attrs:{class:"token variable"}},[s._v("$DATE_MINUTE")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{attrs:{class:"token variable"}},[s._v("$DATE_END_MINUTE")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("then")]),s._v(" \n"),t("span",{attrs:{class:"token comment"}},[s._v("#则判断开始时间戳与结束时间戳是否相等")]),s._v("\nSTART_LINE"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("sed -n "),t("span",{attrs:{class:"token string"}},[s._v('"/'),t("span",{attrs:{class:"token variable"}},[s._v("$DATE_MINUTE")]),s._v('/="')]),s._v(" "),t("span",{attrs:{class:"token variable"}},[s._v("$APACHE_LOG")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -n1 \n"),t("span",{attrs:{class:"token comment"}},[s._v("#如果不相等，则取出开始时间戳的行号，与结束时间戳的行号")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("查看tcp的链接状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -nat "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$6")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -rn \n\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -n "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/^tcp/ {++S["),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v("]};END {for(a in S) print a, S[a]}'")]),s._v(" \n\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -n "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/^tcp/ {++state["),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v(']}; END {for(key in state) print key,"\\t",state[key]}\'')]),s._v(" \n\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -n "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/^tcp/ {++arr["),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v(']};END {for(k in arr) print k,"\\t",arr[k]}\'')]),s._v(" \n\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -n "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/^tcp/ {print "),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -rn \n\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ant "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),t("span",{attrs:{class:"token string"}},[s._v("'[a-z]'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ant"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/ip:80/{split("),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v(',ip,":");++S[ip[1]]}END{for (a in S) print S[a],a}\'')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n \n\n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ant"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/:80/{split("),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v(',ip,":");++S[ip[1]]}END{for (a in S) print S[a],a}\'')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -rn"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -n 10 \n\n"),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('\'BEGIN{printf ("http_code\\tcount_num\\n")}{COUNT['),t("span",{attrs:{class:"token variable"}},[s._v("$10")]),s._v(']++}END{for (a in COUNT) printf a"\\t\\t"COUNT[a]"\\n"}\'')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("查找请求数前20个IP（常用于查找网络攻击来源）：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -anlp"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" 80"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" tcp"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F: "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -n20 \n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ant "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/:80/{split("),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v(',ip,":");++A[ip[1]]}END{for(i in A) print A[i],i}\'')]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -rn"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -n20\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("用tcpdump嗅探80端口的访问看看谁最高")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("tcpdump -i eth0 -tnn dst port 80 -c 1000 "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F"),t("span",{attrs:{class:"token string"}},[s._v('"."')]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v('"."'),t("span",{attrs:{class:"token variable"}},[s._v("$2")]),s._v('"."'),t("span",{attrs:{class:"token variable"}},[s._v("$3")]),s._v('"."'),t("span",{attrs:{class:"token variable"}},[s._v("$4")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -20\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查找较多time_wait连接")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" TIME_WAIT"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v("}'")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -rn"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("head")]),s._v(" -n20\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("找查较多的SYN连接")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -an "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" SYN "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F: "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("more")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("根据端口列进程")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ntlp "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" 80 "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$7")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d/ -f1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看了连接数和当前的连接数")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ant "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token variable"}},[s._v("$ip")]),s._v(":80 "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l \n"),t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ant "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token variable"}},[s._v("$ip")]),s._v(":80 "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" EST "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("查看IP访问次数")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -nat"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('":80"')]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$5")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F: "),t("span",{attrs:{class:"token string"}},[s._v("'{print "),t("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("sort")]),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Linux命令分析当前的链接状况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -n "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'/^tcp/ {++S["),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v("]} END {for(a in S) print a, S[a]}'")]),s._v(" \n"),t("span",{attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("\"netstat -n | awk '/^tcp/ {++S[\\"),t("span",{attrs:{class:"token variable"}},[s._v("$NF")]),s._v("]} END {for(a in S) print a, S[a]}'\"")]),s._v("  "),t("span",{attrs:{class:"token comment"}},[s._v("# 通过watch可以一直监控")]),s._v("\nLAST_ACK 5  "),t("span",{attrs:{class:"token comment"}},[s._v("#关闭一个TCP连接需要从两个方向上分别进行关闭，双方都是通过发送FIN来表示单方向数据的关闭，当通信双方发送了最后一个FIN的时候，发送方此时处于LAST_ACK状态，当发送方收到对方的确认（Fin的Ack确认）后才真正关闭整个TCP连接；")]),s._v("\nSYN_RECV 30 "),t("span",{attrs:{class:"token comment"}},[s._v("# 表示正在等待处理的请求数；")]),s._v("\nESTABLISHED 1597 "),t("span",{attrs:{class:"token comment"}},[s._v("# 表示正常数据传输状态；")]),s._v("\nFIN_WAIT1 51 "),t("span",{attrs:{class:"token comment"}},[s._v("# 表示server端主动要求关闭tcp连接；")]),s._v("\nFIN_WAIT2 504 "),t("span",{attrs:{class:"token comment"}},[s._v("# 表示客户端中断连接；")]),s._v("\nTIME_WAIT 1057 "),t("span",{attrs:{class:"token comment"}},[s._v("# 表示处理完毕，等待超时结束的请求数；")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])])}],!1,null,null,null);r.options.__file="log_analysis.md";a.default=r.exports}}]);