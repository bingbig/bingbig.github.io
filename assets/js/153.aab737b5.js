(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{358:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),a("p",[s._v("除非你开发的是非常简单的控制台应用, 否则你应该不希望php脚本代码产生的输出 直接被扔到激活的终端上. 捕获这些输出和你刚才用以覆写启动处理器的方法类似.")]),s._v(" "),a("p",[s._v("在sapi_module_struct中还有⼀些有用的回调:")]),s._v(" "),s._m(1),s._m(2),s._v(" "),a("p",[s._v("所有用户空间的echo和print语句产生的输出, 以及其他内部通过php_printf()或 PHPWRITE()产生的输出, 最终都将被发送到激活的SAPI的ub_write()方法. 默认情况, 嵌入式SAPI直接将这些数据交给stdout管道, 而不关心你的应用的输出策略.")]),s._v(" "),a("p",[s._v("假设你的应用想要把所有的输出都发送到⼀个独立的控制台窗口; 你可能需要实现⼀个类似于下面伪代码块所描述的回调:")]),s._v(" "),s._m(3),a("p",[s._v("要让这个函数能够处理php产生的内容, 你需要在调用php_embed_init()之前对 php_embed_module结构做适当的修改:")]),s._v(" "),s._m(4),a("p",[s._v("注意: 哪怕你决定你的应用不需要php产生的输出, 也必须为ub_write设置⼀个回调. 将它的值设置为NULL将导致引擎崩溃, 当然, 你的应用也不能幸免.")]),s._v(" "),s._m(5),s._v(" "),a("p",[s._v('你的应用可能会使用缓冲php产生的输出进行优化, sapi层提供了⼀个回调用以通知 你的应用"现在请发送你的缓冲区数据", 你的应用并没有义务去实施这个通知; 不过, 由于 这个信息通常是由于足够的理由(比如到达请求结束位置)才产生的, 听从这个意见并不会有什么坏处.')]),s._v(" "),a("p",[s._v("下面的这对回调函数, 以256字节缓冲区缓冲数据由引擎安排执行flush.")]),s._v(" "),s._m(6),a("p",[s._v("在startup_php()中增加下面的代码, 这个基础的缓冲机制就就绪了:")]),s._v(" "),s._m(7),s._m(8),s._v(" "),a("p",[s._v("在启用了log_errors INI设置时, 在启动或执行脚本时如果碰到错误, 将激活 log_message回调. 默认的php错误处理程序会在处理显示(这里是调用log_message回调)之前, 格式化这些错误消息, 使其称为整齐的, 人类可读的内容.")]),s._v(" "),a("p",[s._v("关于log_message回调, 这里你需要注意的第⼀件事是它并不包含长度参数, 因此它并不是二进制安全的. 也就是说, 它只是按照NULL终止来处理字符串末尾.")]),s._v(" "),a("p",[s._v("使用它来做错误报告通常不会有什么问题, 实际上, 它可以用于在错误消息的呈现上 做更多的事情. 默认情况下, sapi/embed将会通过这个简单的内建回调, 发送这些错误消息到标准错误管道:")]),s._v(" "),s._m(9),a("p",[s._v("如果你想发送这些消息到日志文件, 则可以使用下面的版本替代:")]),s._v(" "),s._m(10),s._m(11),s._v(" "),a("p",[s._v("少数特殊情况的错误属于某个sapi, 因此将绕过php的主错误处理程序. 这些错误一般 是由于使用不当造成的, 比如非web应用不应该使用header()函数, 上传文件到控制台应用程序等.")]),s._v(" "),a("p",[s._v("由于这些情况都离你所开发的sapi/embed应用非常遥远, 因此最好保持这个回调为空. 不过, 如果你非要坚持去捕获每种类型错误的源, 也只需要实现⼀个回调函数, 并在调 用php_embed_init()之前覆写它就可以了.")]),s._v(" "),s._m(12),s._v(" "),a("ul",[a("li",[a("router-link",{attrs:{to:"./preface.html"}},[s._v("目录")])],1),s._v(" "),a("li",[s._v("20.4 "),a("router-link",{attrs:{to:"./20.4.html"}},[s._v("覆写INI_SYSTEM和INI_PERDIR选项")])],1),s._v(" "),a("li",[s._v("20.6 "),a("router-link",{attrs:{to:"./20.6.html"}},[s._v("同时扩展和嵌入")])],1)])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"捕获输出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#捕获输出","aria-hidden":"true"}},[this._v("#")]),this._v(" 捕获输出")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" _sapi_module_struct "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("ub_write"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("str"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" str_length TSRMLS_DC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("flush"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("server_context"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sapi_error"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" type"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("error_msg"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("log_message"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("message"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" sapi_module_struct"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"标准输出-ub-write"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标准输出-ub-write","aria-hidden":"true"}},[this._v("#")]),this._v(" 标准输出: ub_write")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("embed4_ub_write")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("str"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" str_length TSRMLS_DC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("output_string_to_window")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CONSOLE_WINDOW_ID"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" str"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("php_embed_module"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ub_write "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" embed4_ub_write"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"缓冲输出-flush"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓冲输出-flush","aria-hidden":"true"}},[this._v("#")]),this._v(" 缓冲输出: Flush")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("￼"),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buffer"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("256")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" buffer_pos "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("embed4_ubwrite")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("str"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" str_length TSRMLS_DC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("s "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" str"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("d "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" buffer "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" buffer_pos"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" consumed "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("/* 缓冲区够用, 直接追加到缓冲区后面 */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str_length "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("256")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v(" buffer_pos"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("memcpy")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        buffer_pos "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nconsumed "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v(" buffer_pos"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("memcpy")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" consumed"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("embed4_output_chunk")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" str_length "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" consumed"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ns "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" consumed"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("/* 消耗整个传入的块 */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str_length "),a("span",{attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("embed4_output_chunk")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        s "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        consumed "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("/* 重置缓冲区头指针内容 */")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("memcpy")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" buffer_pos "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" consumed "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" str_length"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" consumed"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("embed4_flush")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("server_context"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer_pos "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("/* 输出缓冲区中剩下的内容 */")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("embed4_output_chunk")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer_pos"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" buffer_pos "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("php_embed_module"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ub_write "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" embed4_ub_write"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nphp_embed_module"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flush    "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" embed4_flush"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"标准错误-log-message"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标准错误-log-message","aria-hidden":"true"}},[this._v("#")]),this._v(" 标准错误: log_message")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("php_embed_log_message")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("message"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    fprintf "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token constant"}},[s._v("stderr")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"%s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("embed4_log_message")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("message"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    FILE "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("log"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    log "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("fopen")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"/var/log/embed4.log"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"a"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fprintf "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"%s\\n"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("fclose")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"特殊错误-sapi-error"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#特殊错误-sapi-error","aria-hidden":"true"}},[this._v("#")]),this._v(" 特殊错误: sapi_error")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"links"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#links","aria-hidden":"true"}},[this._v("#")]),this._v(" links")])}],!1,null,null,null);e.options.__file="20.5.md";t.default=e.exports}}]);