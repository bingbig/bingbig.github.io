(window.webpackJsonp=window.webpackJsonp||[]).push([[208],{281:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"字节排序函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#字节排序函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 字节排序函数")]),s._v(" "),n("blockquote",[n("p",[s._v("考虑一个16位的整数，它由2个字节组成。在内存中，存储这16位整数的方法有两种：")]),s._v(" "),n("ol",[n("li",[s._v("将底序字节存储在起始地址，这称为小端（little-endian）字节序；")]),s._v(" "),n("li",[s._v("将高序字节存储在起始地址，称为大端（big-endian）字节序。")])])]),s._v(" "),n("p",[s._v("可以用C代码验证你的机器是哪种存储方式：")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("/* file: lib/byteorder.c */")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("main")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[s._v("union")]),s._v(" \n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("short")]),s._v(" s"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("char")]),s._v(" c"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("short")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" un"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    un"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0x0102")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("short")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("un"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" un"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"big-endian\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("un"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" un"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"little-endian\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"unknown!\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"The short size is not 2!\\n"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("p",[s._v("由于历史的原因和POSIX规范的规定，套接字地址结构中的某些字段必须按照网络字节序进行维护，因此我们要关注如何在主机字节序和网络字节序之间互相转换。这两种字节序之间的转换可以使用以下四个函数。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("<netinet/in.h>")])]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/* 返回网络字节序 */")]),s._v("\nu_int16_t "),n("span",{attrs:{class:"token function"}},[s._v("htons")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u_int16_t host16bitvalue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nu_int32_t "),n("span",{attrs:{class:"token function"}},[s._v("htonl")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u_int32_t host32bitvalue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/* 返回主机字节序 */")]),s._v("\nu_int16_t "),n("span",{attrs:{class:"token function"}},[s._v("ntohs")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u_int16_t net16bitvalue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nu_int32_t "),n("span",{attrs:{class:"token function"}},[s._v("ntohl")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("u_int32_t net32bitvalue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("在这些字节序函数中，"),n("code",[s._v("h")]),s._v("代表"),n("code",[s._v("host")]),s._v("， "),n("code",[s._v("n")]),s._v(" 代表 "),n("code",[s._v("network")]),s._v("， "),n("code",[s._v("s")]),s._v(" 代表 "),n("code",[s._v("short")]),s._v("，"),n("code",[s._v("l")]),s._v("代表"),n("code",[s._v("long")]),s._v("。")]),s._v(" "),n("p",[s._v("当使用这些函数时，我们不需要关心主机字节序和网络字节序的到底是什么，只需要调用适当的调整函数在主机和网络之间转换某个值。在那些和网际协议所用字节序（"),n("strong",[s._v("大端")]),s._v("）相同的系统中，这四个函数通常被定义为空宏。")])])}],!1,null,null,null);e.options.__file="byteorder.md";t.default=e.exports}}]);