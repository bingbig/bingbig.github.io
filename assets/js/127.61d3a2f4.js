(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{397:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[s._m(0),s._v(" "),n("p",[s._v("在php 5.1中, 扩展之间的内部依赖是可以强制性的. 由于扩展可以静态构建到php中, 也可以构建为共享对象动态加载, 因此强制依赖需要在两个地方实现.")]),s._v(" "),s._m(1),s._v(" "),n("p",[s._v("第一个位置是你在本章课程中刚刚看到的config.m4文件中. 你可以使用PHP_ADD_EXTENSION_DEP(extname, depname[ , optional])宏标识extname这个扩展依赖于depname这个扩展. 当extname以静态方式构建到php中时, ./configure脚本将使用这一行代码确认depname必须首先初始化. optional参数是一个标记, 用来标识depname如果也是静态构建的, 应该在extname之前加载, 不过它并不是必须的依赖.")]),s._v(" "),n("p",[s._v("这个宏的一个使用示例是pdo驱动, 比如pdo_mysql是可预知依赖于pdo扩展的:")]),s._v(" "),s._m(2),n("p",[s._v("要注意PHP_ADD_EXTENSION_DEP()宏被包裹到一个ifdef()结构中. 这是因为pdo和它的驱动在编译大于或等于5.0版本的php时都是存在的, 然而PHP_ADD_EXTENSION_DEP()宏是直到5.1.0版本才出现的.")]),s._v(" "),s._m(3),s._v(" "),n("p",[s._v("另外一个你需要注册依赖的地方是zend_module_entry结构体中. 考虑下面第5章中你定义的zend_module_entry结构体:")]),s._v(" "),s._m(4),n("p",[s._v("增加运行时模块依赖信息就需要对STANDARD_MOUDLE_HEADER部分进行一些小修改:")]),s._v(" "),s._m(5),n("p",[s._v("现在, 如果ZEND_MODULE_API_NO高于php 5.1.0 beta发布版, 则STANDARD_MODULE_HEADER(译注: 这里原著笔误为STANDARD_MODULE_PROPERTIES)将被替换为略微复杂的结构, 它将包含一个指向模块依赖信息的引用.")]),s._v(" "),n("p",[s._v("这个目标结构体可以在你的zend_module_entry结构体上面定义如下:")]),s._v(" "),s._m(6),n("p",[s._v("和zend_function_entry向量类似, 这个列表可以有多项依赖, 按照顺序进行检查. 如果尝试加载某个依赖模块未满足, Zend将会中断加载, 报告不满足依赖的名字, 这样, 终端用户就可以通过首先加载其他模块来解决问题.")]),s._v(" "),s._m(7),s._v(" "),n("ul",[n("li",[n("router-link",{attrs:{to:"./preface.html"}},[s._v("目录")])],1),s._v(" "),n("li",[s._v("17.2 "),n("router-link",{attrs:{to:"./17.2.html"}},[s._v("库的查找")])],1),s._v(" "),n("li",[s._v("17.4 "),n("router-link",{attrs:{to:"./17.4.html"}},[s._v("Windows方言")])],1)])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"强制模块依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强制模块依赖","aria-hidden":"true"}},[this._v("#")]),this._v(" 强制模块依赖")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"配置时模块依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置时模块依赖","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置时模块依赖")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("ifdef")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PHP_ADD_EXTENDION_DEP"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("PHP_ADD_EXTENSION_DEP")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pdo_mysql"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pdo"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"运行时模块依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行时模块依赖","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行时模块依赖")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("zend_module_entry sample_module_entry "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("if")]),s._v(" ZEND_MODULE_API_NO >= 20010901")]),s._v("\n    STANDARD_MODULE_HEADER"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n    PHP_SAMPLE_EXTNAME"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    php_sample_functions"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* MINIT */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* MSHUTDOWN */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* RINIT */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* RSHUTDOWN */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* MINFO */")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("if")]),s._v(" ZEND_MODULE_API_NO >= 20010901")]),s._v("\n    PHP_SAMPLE_EXTVER"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n    STANDARD_MODULE_PROPERTIES\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("zend_module_entry sample_module_entry "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("if")]),s._v(" ZEND_MODULE_API_NO >= 220050617")]),s._v("\n    STANDARD_MODULE_HEADER_EX"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    php_sample_deps"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("elif")]),s._v(" ZEND_MODULE_API_NO >= 20010901")]),s._v("\n    STANDARD_MODULE_HEADER"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n    PHP_SAMPLE_EXTNAME"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    php_sample_functions"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* MINIT */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* MSHUTDOWN */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* RINIT */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* RSHUTDOWN */")]),s._v("\n    "),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("/* MINFO */")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("if")]),s._v(" ZEND_MODULE_API_NO >= 20010901")]),s._v("\n    PHP_SAMPLE_EXTVER"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n    STANDARD_MODULE_PROPERTIES\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("if")]),s._v(" ZEND_MODULE_API_NO >= 220050617")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" zend_module_dep php_sample_deps"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("ZEND_MODULE_REQUIRED")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"zlib"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token macro property"}},[s._v("#"),n("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"links"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#links","aria-hidden":"true"}},[this._v("#")]),this._v(" links")])}],!1,null,null,null);e.options.__file="17.3.md";t.default=e.exports}}]);