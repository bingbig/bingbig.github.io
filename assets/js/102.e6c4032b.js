(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{434:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),a("p",[s._v("这一章，我们将学会如何在PHP扩展中使用全局变量。")]),s._v(" "),a("p",[s._v("在扩展中定义全局变量")]),s._v(" "),a("p",[s._v("首先，我们需要在扩展的头文件中(默认是php_*.h)中定义所有的全局变量。举个例子，比如我们要定义一个无符号的long类型的全局变量，我们可以这样定义：")]),s._v(" "),s._m(1),a("p",[s._v("用ZEND_BEGIN_MODULE_GLOBALS和ZEND_END_MODULE_GLOBALS宏将定义的全局变量包起来。将上例中的宏展开后，是下面这个样子：")]),s._v(" "),s._m(2),a("p",[s._v("如果你还有其他的全局变量需要定义，只需加在两个宏之间就可以了。接下来我们该在simple4.c中声明我们在头文件中定义的这些全局变量了：")]),s._v(" "),s._m(3),a("p",[s._v("这个宏的内部实现取决于是否启用了线程安全，在非线程安全的环境下，如：Apache1，Apache2-prefork, CGI，CLI...会使用zend_sample4_globals结构来定义\n全局变量：")]),s._v(" "),s._m(4),a("p",[s._v("我们可以直接通过sample4_globals.counter来获取计数器的值。在线程安全的版本中，另一种方法是声明一个整数：")]),s._v(" "),s._m(5),a("p",[s._v("填充这个ID就等于定义了扩展中的全局变量。根据其定义的信息，将为每个新线程的独立存储空间分配内存块。我们可以在MINIT中这样定义：")]),s._v(" "),s._m(6),a("p",[s._v("有一点需要注意这种方法需要包裹在#ifdef中，以防止它在没有启动Zend Thread Safety(ZTS)时执行。因为sample4_globals_id只能在多线程环境中使用。非线程\n的版本用我们在前面提到的sample4_globals来声明全局变量。")]),s._v(" "),a("p",[s._v("线程中的初始化和关闭")]),s._v(" "),a("p",[s._v("在非线程的环境中，会将一个zend_sample4_globals结构的副本保存在指定进程中。你可以指定他的默认值，或者在MINIT或者RINIT中分配资源来初始化它。要记得\n在对应的MSHUTDOWN或者RSHUTDOWN中及时释放这些资源。")]),s._v(" "),a("p",[s._v("然而在线程版本中，一个新的结构会在一个新线程spun的时候被分配。为了知道怎样初始化和关闭扩展中的全局变量，需要向ZE引擎提供回调函数。在前面我们在调用\nts_allocate_id()的时候是是以NULL来作为这个值的，接下来我们添加2个一会需要在MINIT调用的方法：")]),s._v(" "),s._m(7),a("p",[s._v("我们在启用和关闭的时候调用它们：")]),s._v(" "),s._m(8),a("p",[s._v("现在我们已经知道如何在扩展中创建全局变量了，在不是ZTS的环境中，使用它们很简单，我们还来看前面定义的那个计数器的递增功能如何实现：")]),s._v(" "),s._m(9),a("p",[s._v("是不是看起来很简单，但是，在线程版本中将无法正常工作。那么我们来看看怎么在线程环境中完成这个功能吧：")]),s._v(" "),s._m(10),a("p",[s._v("看起来很丑对吗？想象一下，在你的整个代码库中，这些IFDEF指令在每一个线程安全的全局访问时穿插。它会看起来比Perl更糟糕！这就是为什么所有\n的核心扩展，都有使用一个额外的宏观层抽象这种情况。我们可以在php_sample4.h中找到下面这段代码：")]),s._v(" "),s._m(11),a("p",[s._v("使用它们会让你的方法看起来更简洁：")]),s._v(" "),s._m(12),a("p",[s._v("看到*G()这样的宏是不是有种似曾相识的感觉？也许以前你看到过EG()、CG()等宏，了解他们会让你对PHP的了解更深一步：")]),s._v(" "),s._m(13),s._v(" "),s._m(14),s._v(" "),a("ul",[a("li",[a("router-link",{attrs:{to:"./preface.html"}},[s._v("目录")])],1),s._v(" "),a("li",[s._v("12.3 "),a("router-link",{attrs:{to:"./12.3.html"}},[s._v("常量")])],1),s._v(" "),a("li",[s._v("12.5 "),a("router-link",{attrs:{to:"./12.5.html"}},[s._v("PHP语言中的超级全局变量")])],1)])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"_12-4-php扩展中的全局变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-4-php扩展中的全局变量","aria-hidden":"true"}},[this._v("#")]),this._v(" 12.4 PHP扩展中的全局变量")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("ZEND_BEGIN_MODULE_GLOBALS")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("long")]),s._v(" counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("ZEND_END_MODULE_GLOBALS")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" _zend_sample4_globals "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("long")]),s._v(" counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" zend_sample4_globals"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("ZEND_DECLARE_MODULE_GLOBALS")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[this._v("zend_sample4_globals sample4_globals"),t("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[this._v("int")]),this._v(" sample4_globals_id"),t("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("ifdef")]),s._v(" ZTS")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("ts_allocate_id")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            "),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("sample4_globals_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("zend_sample4_globals"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("php_sample4_globals_ctor")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("zend_sample4_globals "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sample4_globals TSRMLS_DC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("/* Initialize a new zend_sample4_globals struct\n     * During thread spin-up */")]),s._v("\n     sample4_globals"),a("span",{attrs:{class:"token operator"}},[s._v("->")]),s._v("counter "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("php_sample4_globals_dtor")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("zend_sample4_globals "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("sample4_globals TSRMLS_DC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("/* Any resources allocated during initialization\n     * May be freed here */")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("PHP_MINIT_FUNCTION")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("REGISTER_STRING_CONSTANT")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"SAMPLE4_VERSION"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PHP_SAMPLE4_EXTVER"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" CONST_CS "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" CONST_PERSISTENT"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("ifdef")]),s._v(" ZTS")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("ts_allocate_id")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("sample4_globals_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),a("span",{attrs:{class:"token keyword"}},[s._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("zend_sample4_globals"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ts_allocate_ctor"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("php_sample4_globals_ctor"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ts_allocate_dtor"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("php_sample4_globals_dtor"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("else")])]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("php_sample4_globals_ctor")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("sample4_globals TSRMLS_CC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" SUCCESS"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token function"}},[s._v("PHP_MSHUTDOWN_FUNCTION")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("ifndef")]),s._v(" ZTS")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("php_sample4_globals_dtor")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("&")]),s._v("sample4_globals TSRMLS_CC"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" SUCCESS"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("PHP_FUNCTION")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4_counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("RETURN_LONG")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v("sample4_globals"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("PHP_FUNCTION")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4_counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("ifdef")]),s._v(" ZTS")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("RETURN_LONG")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("++")]),a("span",{attrs:{class:"token function"}},[s._v("TSRMG")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4_globals_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \\\n                zend_sample4_globals"),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("else")])]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("/* non-ZTS */")]),s._v("\n        "),a("span",{attrs:{class:"token function"}},[s._v("RETURN_LONG")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v("sample4_globals"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("ifdef")]),s._v(" ZTS")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"TSRM.h"')])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" SAMPLE4_G(v) TSRMG(sample4_globals_id, zend_sample4_globals*, v)")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("else")])]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" SAMPLE4_G(v) (sample4_globals.v)")]),s._v("\n"),a("span",{attrs:{class:"token macro property"}},[s._v("#"),a("span",{attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("PHP_FUNCTION")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sample4_counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("RETURN_LONG")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("++")]),a("span",{attrs:{class:"token function"}},[s._v("SAMPLE4_G")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counter"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("table",[a("thead",[a("tr",[a("th",[s._v("Accessor Macro")]),s._v(" "),a("th",[s._v("Associated Data")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("EG()")]),s._v(" "),a("td",[s._v("这个宏可以用来访问符号表，函数，资源信息和常量。")])]),s._v(" "),a("tr",[a("td",[s._v("CG()")]),s._v(" "),a("td",[s._v("用来访问核心全局变量。")])]),s._v(" "),a("tr",[a("td",[s._v("PG()")]),s._v(" "),a("td",[s._v("PHP全局变量。我们知道php.ini会映射一个或者多个PHP全局结构。举几个使用这个宏的例子：PG(register_globals), PG(safe_mode), PG(memory_limit)")])]),s._v(" "),a("tr",[a("td",[s._v("FG()")]),s._v(" "),a("td",[s._v("文件全局变量。大多数文件I/O或相关的全局变量的数据流都塞进标准扩展出口结构。")])])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"links"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#links","aria-hidden":"true"}},[this._v("#")]),this._v(" links")])}],!1,null,null,null);e.options.__file="12.4.md";t.default=e.exports}}]);